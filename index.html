<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ t('shop_name') }}</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { padding: 20px; }
.table th, .table td { vertical-align: middle; text-align: center; }
.language-btn { margin-right: 10px; }
</style>
</head>
<body dir="{{ 'rtl' if lang=='ar' else 'ltr' }}">

<div class="container">

<!-- رأس الصفحة مع أزرار اللغة -->
<div class="d-flex justify-content-between align-items-center mb-4">
<h1>{{ t('shop_name') }}</h1>
<div>
<!-- أزرار اللغة تعمل داخلياً على التطبيق -->
<a href="/?lang=ar" class="btn btn-outline-primary language-btn">🇸🇦 Arabic</a>
<a href="/?lang=en" class="btn btn-outline-secondary language-btn">🇺🇸 English</a>
</div>
</div>

<!-- المنتجات -->
<div class="card mb-4">
<div class="card-header"><h2>{{ t('products_list') }}</h2></div>
<div class="card-body p-0">
<table class="table table-striped mb-0">
<thead class="table-dark">
<tr>
<th>{{ t('product_name') }}</th>
<th>{{ t('category') }}</th>
<th>{{ t('price') }}</th>
<th>{{ t('available') }}</th>
<th>{{ t('sell') }}</th>
</tr>
</thead>
<tbody>
{% for p in products %}
<tr>
<td>{{ p['name'] }}</td>
<td>{{ p['category'] }}</td>
<td>{{ p['price'] }}</td>
<td>{{ p['quantity'] }}</td>
<td>
{% if p['quantity']>0 %}
<form method="post" action="/sell_product/{{ p['id'] }}" class="d-flex justify-content-center">
<input type="number" name="sold_quantity" min="1" max="{{ p['quantity'] }}" required class="form-control form-control-sm me-2" style="width:80px;">
<button type="submit" class="btn btn-success btn-sm">{{ t('sell_button') }}</button>
</form>
{% else %}
<span class="text-danger">{{ t('out_of_stock') }}</span>
{% endif %}
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

<!-- إضافة منتج -->
<div class="card mb-4">
<div class="card-header"><h2>{{ t('add_product') }}</h2></div>
<div class="card-body">
<form method="post" action="/add_product" class="row g-3">
<div class="col-md-3"><input type="text" name="name" placeholder="{{ t('product_name') }}" class="form-control" required></div>
<div class="col-md-3"><input type="text" name="category" placeholder="{{ t('category') }}" class="form-control" required></div>
<div class="col-md-2"><input type="number" step="0.01" name="price" placeholder="{{ t('price') }}" class="form-control" required></div>
<div class="col-md-2"><input type="number" name="quantity" placeholder="{{ t('available') }}" class="form-control" required></div>
<div class="col-md-2"><button type="submit" class="btn btn-primary w-100">{{ t('add_button') }}</button></div>
</form>
</div>
</div>

<!-- تقرير المبيعات -->
<div class="card mb-4">
<div class="card-header d-flex justify-content-between align-items-center">
<h2>{{ t('sales_report') }}</h2>
<div>
<a href="/export/excel" class="btn btn-outline-success btn-sm">{{ t('export_excel') }}</a>
<a href="/export/pdf" class="btn btn-outline-danger btn-sm">{{ t('export_pdf') }}</a>
</div>
</div>
<div class="card-body p-0">
<p class="m-3">{{ t('total_sales') }}: <strong>{{ total_sales }}</strong></p>
<table class="table table-striped mb-0">
<thead class="table-dark">
<tr>
<th>{{ t('product_name') }}</th>
<th>{{ t('quantity_sold') }}</th>
<th>{{ t('price') }}</th>
<th>{{ t('total') }}</th>
<th>{{ t('date') }}</th>
</tr>
</thead>
<tbody>
{% for s in sales %}
<tr>
<td>{{ s['name'] }}</td>
<td>{{ s['quantity'] }}</td>
<td>{{ s['price'] }}</td>
<td>{{ s['total'] }}</td>
<td>{{ s['date'] }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

<!-- مخطط المبيعات اليومية -->
<div class="card mb-4">
<div class="card-header"><h2>📊 Sales Chart</h2></div>
<div class="card-body">
<canvas id="salesChart" height="100"></canvas>
</div>
</div>

</div>

<script>
fetch('/sales_chart_data')
.then(response => response.json())
.then(data => {
const ctx = document.getElementById('salesChart').getContext('2d');
new Chart(ctx, {
type: 'bar',
data: {
labels: data.labels,
datasets: [{
label: 'Sales',
data: data.totals,
backgroundColor: 'rgba(54, 162, 235, 0.6)',
borderColor: 'rgba(54, 162, 235, 1)',
borderWidth: 1
}]
},
options: {
responsive: true,
scales: { y: { beginAtZero: true } }
}
});
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
